<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>費用申請管理系統</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 登入頁面樣式 */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .login-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .login-logo {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .login-title {
            font-size: 2em;
            margin-bottom: 30px;
            color: #333;
            font-weight: 300;
        }
        
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e1e1;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .demo-info {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4fd;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }
        
        /* 主應用樣式 */
        .app-container {
            display: none;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.5em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .main-content {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            gap: 20px;
            padding: 20px;
        }
        
        .sidebar {
            width: 280px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            height: fit-content;
            overflow: hidden;
        }
        
        .nav-item {
            display: block;
            padding: 15px 20px;
            color: #666;
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .nav-item:hover, .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateX(5px);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        .content-area {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 30px;
        }
        
        .page-title {
            font-size: 2em;
            margin-bottom: 30px;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* 表格樣式 */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 500;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        /* 按鈕樣式 */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        /* 表單樣式 */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* 隱藏所有頁面，只顯示當前活動頁面 */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* 卡片樣式 */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid #eee;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-weight: 500;
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* 工具欄 */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .toolbar-left {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* 狀態標籤 */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* 響應式設計 */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                padding: 10px;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
            }
            
            .content-area {
                order: 1;
                padding: 20px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        /* 檔案上傳區域 */
        .file-upload {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .file-upload.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }
    </style>
</head>
<body>
    <!-- 登入頁面 -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-receipt"></i>
            </div>
            <h2 class="login-title">費用申請管理系統</h2>
            <form id="loginForm">
                <div class="form-group">
                    <input type="text" id="username" class="form-input" placeholder="帳號" required>
                </div>
                <div class="form-group">
                    <input type="password" id="password" class="form-input" placeholder="密碼" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> 登入
                </button>
            </form>
            <div class="demo-info">
                <strong>測試帳號：</strong><br>
                帳號：admin<br>
                密碼：admin123<br><br>
                帳號：user<br>
                密碼：user123
            </div>
        </div>
    </div>

    <!-- 主應用程式 -->
    <div id="mainApp" class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-receipt"></i>
                    費用申請管理系統
                </div>
                <div class="user-menu">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="currentUser">使用者</span>
                        <span id="currentDept" class="status-badge status-approved"></span>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> 登出
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <nav class="sidebar">
                <a href="#" class="nav-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    儀表板
                </a>
                <a href="#" class="nav-item" onclick="showPage('expense-form')">
                    <i class="fas fa-plus-circle"></i>
                    新增費用申請
                </a>
                <a href="#" class="nav-item" onclick="showPage('expense-list')">
                    <i class="fas fa-list"></i>
                    費用申請清單
                </a>
                <a href="#" class="nav-item" onclick="showPage('account-management')">
                    <i class="fas fa-chart-bar"></i>
                    會計科目管理
                </a>
                <a href="#" class="nav-item" onclick="showPage('department-management')">
                    <i class="fas fa-building"></i>
                    部門管理
                </a>
                <a href="#" class="nav-item" onclick="showPage('import-export')">
                    <i class="fas fa-exchange-alt"></i>
                    匯入匯出
                </a>
            </nav>

            <main class="content-area">
                <!-- 儀表板頁面 -->
                <div id="dashboard" class="page active">
                    <h2 class="page-title">
                        <i class="fas fa-tachometer-alt"></i>
                        儀表板
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-clock"></i> 待審核申請
                            </div>
                            <div class="card-body">
                                <div style="font-size: 2em; font-weight: bold; color: #ffc107;">3</div>
                                <p>筆申請等待審核</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-check-circle"></i> 已核准申請
                            </div>
                            <div class="card-body">
                                <div style="font-size: 2em; font-weight: bold; color: #28a745;">12</div>
                                <p>筆申請已核准</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-dollar-sign"></i> 本月費用
                            </div>
                            <div class="card-body">
                                <div style="font-size: 2em; font-weight: bold; color: #667eea;">NT$45,280</div>
                                <p>本月總費用金額</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-chart-line"></i> 最近申請記錄
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>申請日期</th>
                                            <th>費用類型</th>
                                            <th>金額</th>
                                            <th>狀態</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2025-08-14</td>
                                            <td>交通費</td>
                                            <td>NT$2,500</td>
                                            <td><span class="status-badge status-pending">待審核</span></td>
                                        </tr>
                                        <tr>
                                            <td>2025-08-13</td>
                                            <td>餐飲費</td>
                                            <td>NT$1,200</td>
                                            <td><span class="status-badge status-approved">已核准</span></td>
                                        </tr>
                                        <tr>
                                            <td>2025-08-12</td>
                                            <td>住宿費</td>
                                            <td>NT$8,000</td>
                                            <td><span class="status-badge status-approved">已核准</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 新增費用申請頁面 -->
                <div id="expense-form" class="page">
                    <h2 class="page-title">
                        <i class="fas fa-plus-circle"></i>
                        新增費用申請
                    </h2>
                    
                    <form id="expenseForm" class="card">
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseType">費用類型 <span style="color:red">*</span></label>
                                    <select id="expenseType" class="form-control" required>
                                        <option value="">請選擇費用類型</option>
                                        <option value="511001">交通費</option>
                                        <option value="512001">餐飲費</option>
                                        <option value="513001">住宿費</option>
                                        <option value="514001">辦公用品</option>
                                        <option value="515001">通訊費</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="amount">申請金額 <span style="color:red">*</span></label>
                                    <input type="number" id="amount" class="form-control" placeholder="請輸入金額" required min="1">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseDate">費用日期 <span style="color:red">*</span></label>
                                    <input type="date" id="expenseDate" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="applicantDept">申請人部門</label>
                                    <select id="applicantDept" class="form-control">
                                        <option value="IT">資訊部</option>
                                        <option value="HR">人資部</option>
                                        <option value="FINANCE">財務部</option>
                                        <option value="SALES">業務部</option>
                                        <option value="MARKETING">行銷部</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="description">費用說明</label>
                                <textarea id="description" class="form-control" rows="3" placeholder="請輸入費用說明"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="receipt">上傳收據</label>
                                <div class="file-upload" onclick="document.getElementById('receiptFile').click()">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 2em; color: #ccc; margin-bottom: 10px;"></i>
                                    <p>點擊或拖拽上傳收據檔案</p>
                                    <input type="file" id="receiptFile" style="display: none;" accept="image/*,.pdf" multiple>
                                </div>
                                <div id="uploadedFiles" style="margin-top: 10px;"></div>
                            </div>
                            
                            <div style="text-align: right; margin-top: 30px;">
                                <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                    <i class="fas fa-undo"></i> 重設
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> 送出申請
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- 費用申請清單頁面 -->
                <div id="expense-list" class="page">
                    <h2 class="page-title">
                        <i class="fas fa-list"></i>
                        費用申請清單
                    </h2>
                    
                    <div class="toolbar">
                        <div class="toolbar-left">
                            <input type="text" id="searchInput" class="form-control" placeholder="搜尋..." style="width: 200px;">
                            <select id="statusFilter" class="form-control" style="width: 150px;">
                                <option value="">所有狀態</option>
                                <option value="pending">待審核</option>
                                <option value="approved">已核准</option>
                                <option value="rejected">已拒絕</option>
                            </select>
                        </div>
                        <div>
                            <button class="btn btn-success" onclick="exportExpenses()">
                                <i class="fas fa-download"></i> 匯出Excel
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-container">
                                <table id="expenseTable">
                                    <thead>
                                        <tr>
                                            <th>申請編號</th>
                                            <th>申請日期</th>
                                            <th>費用類型</th>
                                            <th>金額</th>
                                            <th>申請人</th>
                                            <th>部門</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expenseTableBody">
                                        <!-- 動態載入資料 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 會計科目管理頁面 -->
                <div id="account-management" class="page">
                    <h2 class="page-title">
                        <i class="fas fa-chart-bar"></i>
                        會計科目管理
                    </h2>
                    
                    <div class="toolbar">
                        <div class="toolbar-left">
                            <input type="text" id="accountSearch" class="form-control" placeholder="搜尋科目..." style="width: 200px;">
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showAddAccountModal()">
                                <i class="fas fa-plus"></i> 新增科目
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>科目代碼</th>
                                            <th>科目名稱</th>
                                            <th>科目類別</th>
                                            <th>狀態</th>
                                            <th>建立日期</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="accountTableBody">
                                        <tr>
                                            <td>511001</td>
                                            <td>交通費</td>
                                            <td>費用類</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>2025-01-01</td>
                                            <td>
                                                <button class="btn btn-info btn-sm" onclick="editAccount('511001')">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteAccount('511001')">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>512001</td>
                                            <td>餐飲費</td>
                                            <td>費用類</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>2025-01-01</td>
                                            <td>
                                                <button class="btn btn-info btn-sm" onclick="editAccount('512001')">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteAccount('512001')">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>513001</td>
                                            <td>住宿費</td>
                                            <td>費用類</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>2025-01-01</td>
                                            <td>
                                                <button class="btn btn-info btn-sm" onclick="editAccount('513001')">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteAccount('513001')">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>514001</td>
                                            <td>辦公用品</td>
                                            <td>費用類</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>2025-01-01</td>
                                            <td>
                                                <button class="btn btn-info btn-sm" onclick="editAccount('514001')">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteAccount('514001')">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>515001</td>
                                            <td>通訊費</td>
                                            <td>費用類</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>2025-01-01</td>
                                            <td>
                                                <button class="btn btn-info btn-sm" onclick="editAccount('515001')">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteAccount('515001')">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 部門管理頁面 -->
                <div id="department-management" class="page">
                    <h2 class="page-title">
                        <i class="fas fa-building"></i>
                        部門管理
                    </h2>
                    
                    <div class="toolbar">
                        <div class="toolbar-left">
                            <input type="text" id="deptSearch" class="form-control" placeholder="搜尋部門..." style="width: 200px;">
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showAddDeptModal()">
                                <i class="fas fa-plus"></i> 新增部門
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>部門代碼</th>
                                            <th>部門名稱</th>
                                            <th>部門主管</th>
                                            <th>人數</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>IT</td>
                                            <td>資訊部</td>
                                            <td>王大明</td>
                                            <td>15</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>
                                                <button class="btn btn-info btn-sm">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>HR</td>
                                            <td>人資部</td>
                                            <td>李小華</td>
                                            <td>8</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>
                                                <button class="btn btn-info btn-sm">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>FINANCE</td>
                                            <td>財務部</td>
                                            <td>陳志明</td>
                                            <td>12</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>
                                                <button class="btn btn-info btn-sm">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>SALES</td>
                                            <td>業務部</td>
                                            <td>林美玲</td>
                                            <td>20</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>
                                                <button class="btn btn-info btn-sm">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>MARKETING</td>
                                            <td>行銷部</td>
                                            <td>張偉強</td>
                                            <td>10</td>
                                            <td><span class="status-badge status-approved">啟用</span></td>
                                            <td>
                                                <button class="btn btn-info btn-sm">
                                                    <i class="fas fa-edit"></i> 編輯
                                                </button>
                                                <button class="btn btn-danger btn-sm">
                                                    <i class="fas fa-trash"></i> 刪除
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 匯入匯出頁面 -->
                <div id="import-export" class="page">
                    <h2 class="page-title">
                        <i class="fas fa-exchange-alt"></i>
                        匯入匯出
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <!-- 匯入區域 -->
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-upload"></i> 資料匯入
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label>選擇匯入類型</label>
                                    <select class="form-control" id="importType">
                                        <option value="expenses">費用申請資料</option>
                                        <option value="accounts">會計科目資料</option>
                                        <option value="departments">部門資料</option>
                                    </select>
                                </div>
                                
                                <div class="file-upload" onclick="document.getElementById('importFile').click()">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 3em; color: #667eea; margin-bottom: 15px;"></i>
                                    <h4>選擇檔案匯入</h4>
                                    <p>支援 Excel (.xlsx) 或 CSV (.csv) 格式</p>
                                    <input type="file" id="importFile" style="display: none;" accept=".xlsx,.xls,.csv">
                                </div>
                                
                                <div style="margin-top: 20px;">
                                    <button class="btn btn-primary" style="width: 100%;" onclick="processImport()">
                                        <i class="fas fa-upload"></i> 開始匯入
                                    </button>
                                </div>
                                
                                <div style="margin-top: 15px; text-align: center;">
                                    <a href="#" class="btn btn-info" onclick="downloadTemplate()">
                                        <i class="fas fa-download"></i> 下載範本檔案
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 匯出區域 -->
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-download"></i> 資料匯出
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label>選擇匯出類型</label>
                                    <select class="form-control" id="exportType">
                                        <option value="expenses">費用申請資料</option>
                                        <option value="accounts">會計科目資料</option>
                                        <option value="departments">部門資料</option>
                                    </select>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>開始日期</label>
                                        <input type="date" class="form-control" id="exportStartDate">
                                    </div>
                                    <div class="form-group">
                                        <label>結束日期</label>
                                        <input type="date" class="form-control" id="exportEndDate">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>匯出格式</label>
                                    <select class="form-control" id="exportFormat">
                                        <option value="xlsx">Excel (.xlsx)</option>
                                        <option value="csv">CSV (.csv)</option>
                                        <option value="pdf">PDF (.pdf)</option>
                                    </select>
                                </div>
                                
                                <div style="margin-top: 30px;">
                                    <button class="btn btn-success" style="width: 100%;" onclick="processExport()">
                                        <i class="fas fa-download"></i> 開始匯出
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 匯入匯出記錄 -->
                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header">
                            <i class="fas fa-history"></i> 匯入匯出記錄
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>操作時間</th>
                                            <th>操作類型</th>
                                            <th>資料類型</th>
                                            <th>檔案名稱</th>
                                            <th>狀態</th>
                                            <th>操作人</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2025-08-14 10:30</td>
                                            <td>匯出</td>
                                            <td>費用申請資料</td>
                                            <td>expense_report_202508.xlsx</td>
                                            <td><span class="status-badge status-approved">成功</span></td>
                                            <td>管理員</td>
                                        </tr>
                                        <tr>
                                            <td>2025-08-13 15:45</td>
                                            <td>匯入</td>
                                            <td>會計科目資料</td>
                                            <td>accounts_import.csv</td>
                                            <td><span class="status-badge status-approved">成功</span></td>
                                            <td>管理員</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // 全域變數
        let currentUser = null;
        let expenses = [];
        let expenseIdCounter = 1;

        // 測試帳號資料
        const users = {
            'admin': {
                password: 'admin123',
                name: '管理員',
                department: 'IT',
                role: 'admin'
            },
            'user': {
                password: 'user123',
                name: '一般使用者',
                department: 'FINANCE',
                role: 'user'
            }
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadSampleData();
        });

        function initializeApp() {
            // 設定登入表單事件
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }

            // 設定費用申請表單事件
            const expenseForm = document.getElementById('expenseForm');
            if (expenseForm) {
                expenseForm.addEventListener('submit', handleExpenseSubmit);
            }

            // 設定檔案上傳
            const receiptFile = document.getElementById('receiptFile');
            if (receiptFile) {
                receiptFile.addEventListener('change', handleFileUpload);
            }

            // 設定今天的日期
            const today = new Date().toISOString().split('T')[0];
            const expenseDate = document.getElementById('expenseDate');
            if (expenseDate) {
                expenseDate.value = today;
            }

            // 設定搜尋和篩選
            const searchInput = document.getElementById('searchInput');
            const statusFilter = document.getElementById('statusFilter');
            
            if (searchInput) {
                searchInput.addEventListener('input', filterExpenses);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', filterExpenses);
            }
        }

        // 處理登入
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert('請輸入帳號和密碼');
                return;
            }

            const user = users[username];
            if (user && user.password === password) {
                currentUser = {
                    username: username,
                    name: user.name,
                    department: user.department,
                    role: user.role
                };
                
                // 隱藏登入頁面，顯示主應用
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // 更新使用者資訊
                document.getElementById('currentUser').textContent = user.name;
                document.getElementById('currentDept').textContent = user.department;
                
                // 載入費用清單
                loadExpenseList();
                
                console.log('登入成功:', currentUser);
            } else {
                alert('帳號或密碼錯誤');
            }
        }

        // 登出功能
        function logout() {
            if (confirm('確定要登出嗎？')) {
                currentUser = null;
                document.getElementById('loginPage').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
                
                // 清空表單
                document.getElementById('loginForm').reset();
                showPage('dashboard');
            }
        }

        // 頁面切換
        function showPage(pageId) {
            // 隱藏所有頁面
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // 顯示選中的頁面
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // 更新導航
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // 找到對應的導航項目並設為活動狀態
            const activeNav = document.querySelector(`[onclick="showPage('${pageId}')"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            // 頁面特定初始化
            if (pageId === 'expense-list') {
                loadExpenseList();
            }
        }

        // 載入範例資料
        function loadSampleData() {
            expenses = [
                {
                    id: 'EXP001',
                    date: '2025-08-14',
                    type: '511001',
                    typeName: '交通費',
                    amount: 2500,
                    applicant: '管理員',
                    department: 'IT',
                    description: '出差交通費',
                    status: 'pending',
                    createDate: '2025-08-14'
                },
                {
                    id: 'EXP002',
                    date: '2025-08-13',
                    type: '512001',
                    typeName: '餐飲費',
                    amount: 1200,
                    applicant: '管理員',
                    department: 'IT',
                    description: '客戶午餐',
                    status: 'approved',
                    createDate: '2025-08-13'
                },
                {
                    id: 'EXP003',
                    date: '2025-08-12',
                    type: '513001',
                    typeName: '住宿費',
                    amount: 8000,
                    applicant: '一般使用者',
                    department: 'FINANCE',
                    description: '出差住宿',
                    status: 'approved',
                    createDate: '2025-08-12'
                }
            ];
            expenseIdCounter = 4;
        }

        // 處理費用申請提交
        function handleExpenseSubmit(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('請先登入');
                return;
            }

            const formData = {
                id: 'EXP' + String(expenseIdCounter).padStart(3, '0'),
                date: document.getElementById('expenseDate').value,
                type: document.getElementById('expenseType').value,
                typeName: document.getElementById('expenseType').selectedOptions[0].textContent,
                amount: parseFloat(document.getElementById('amount').value),
                applicant: currentUser.name,
                department: document.getElementById('applicantDept').value || currentUser.department,
                description: document.getElementById('description').value,
                status: 'pending',
                createDate: new Date().toISOString().split('T')[0]
            };

            expenses.push(formData);
            expenseIdCounter++;

            alert('費用申請提交成功！申請編號：' + formData.id);
            
            // 重設表單
            resetForm();
            
            // 切換到費用清單頁面
            showPage('expense-list');
        }

        // 重設表單
        function resetForm() {
            document.getElementById('expenseForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expenseDate').value = today;
            document.getElementById('uploadedFiles').innerHTML = '';
        }

        // 載入費用清單
        function loadExpenseList() {
            const tbody = document.getElementById('expenseTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            expenses.forEach(expense => {
                const row = document.createElement('tr');
                
                let statusClass = '';
                let statusText = '';
                switch(expense.status) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = '待審核';
                        break;
                    case 'approved':
                        statusClass = 'status-approved';
                        statusText = '已核准';
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        statusText = '已拒絕';
                        break;
                }

                row.innerHTML = `
                    <td>${expense.id}</td>
                    <td>${expense.createDate}</td>
                    <td>${expense.typeName}</td>
                    <td>NT${expense.amount.toLocaleString()}</td>
                    <td>${expense.applicant}</td>
                    <td>${expense.department}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewExpense('${expense.id}')">
                            <i class="fas fa-eye"></i> 查看
                        </button>
                        ${expense.status === 'pending' ? `
                        <button class="btn btn-success btn-sm" onclick="approveExpense('${expense.id}')">
                            <i class="fas fa-check"></i> 核准
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="rejectExpense('${expense.id}')">
                            <i class="fas fa-times"></i> 拒絕
                        </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 篩選費用
        function filterExpenses() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            
            const rows = document.querySelectorAll('#expenseTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const status = row.querySelector('.status-badge').textContent.toLowerCase();
                
                const matchesSearch = searchTerm === '' || text.includes(searchTerm);
                const matchesStatus = statusFilter === '' || 
                    (statusFilter === 'pending' && status.includes('待審核')) ||
                    (statusFilter === 'approved' && status.includes('已核准')) ||
                    (statusFilter === 'rejected' && status.includes('已拒絕'));
                
                row.style.display = matchesSearch && matchesStatus ? '' : 'none';
            });
        }

        // 查看費用詳情
        function viewExpense(id) {
            const expense = expenses.find(e => e.id === id);
            if (expense) {
                let statusText = '';
                switch(expense.status) {
                    case 'pending': statusText = '待審核'; break;
                    case 'approved': statusText = '已核准'; break;
                    case 'rejected': statusText = '已拒絕'; break;
                }
                
                alert(`費用申請詳情：
申請編號：${expense.id}
費用類型：${expense.typeName}
申請金額：NT${expense.amount.toLocaleString()}
申請日期：${expense.date}
申請人：${expense.applicant}
部門：${expense.department}
費用說明：${expense.description}
狀態：${statusText}`);
            }
        }

        // 核准費用
        function approveExpense(id) {
            if (confirm('確定要核准這筆費用申請嗎？')) {
                const expense = expenses.find(e => e.id === id);
                if (expense) {
                    expense.status = 'approved';
                    loadExpenseList();
                    alert('費用申請已核准');
                }
            }
        }

        // 拒絕費用
        function rejectExpense(id) {
            if (confirm('確定要拒絕這筆費用申請嗎？')) {
                const expense = expenses.find(e => e.id === id);
                if (expense) {
                    expense.status = 'rejected';
                    loadExpenseList();
                    alert('費用申請已拒絕');
                }
            }
        }

        // 處理檔案上傳
        function handleFileUpload(e) {
            const files = e.target.files;
            const uploadedFiles = document.getElementById('uploadedFiles');
            
            uploadedFiles.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileDiv = document.createElement('div');
                fileDiv.style.cssText = 'margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; display: flex; align-items: center; gap: 10px;';
                fileDiv.innerHTML = `
                    <i class="fas fa-file"></i>
                    <span>${file.name}</span>
                    <span style="color: #28a745; margin-left: auto;">
                        <i class="fas fa-check"></i> 已上傳
                    </span>
                `;
                uploadedFiles.appendChild(fileDiv);
            }
        }

        // 匯出費用資料
        function exportExpenses() {
            const csvContent = [
                ['申請編號', '申請日期', '費用類型', '金額', '申請人', '部門', '狀態', '說明'],
                ...expenses.map(expense => [
                    expense.id,
                    expense.createDate,
                    expense.typeName,
                    expense.amount,
                    expense.applicant,
                    expense.department,
                    expense.status === 'pending' ? '待審核' : 
                    expense.status === 'approved' ? '已核准' : '已拒絕',
                    expense.description
                ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', '費用申請清單_' + new Date().toISOString().split('T')[0] + '.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 會計科目管理功能
        function showAddAccountModal() {
            const code = prompt('請輸入科目代碼:');
            const name = prompt('請輸入科目名稱:');
            if (code && name) {
                alert(`新增科目成功！\n代碼: ${code}\n名稱: ${name}`);
            }
        }

        function editAccount(code) {
            const newName = prompt(`編輯科目 ${code}，請輸入新名稱:`);
            if (newName) {
                alert(`科目 ${code} 已更新為: ${newName}`);
            }
        }

        function deleteAccount(code) {
            if (confirm(`確定要刪除科目 ${code} 嗎？`)) {
                alert(`科目 ${code} 已刪除`);
            }
        }

        // 部門管理功能
        function showAddDeptModal() {
            const code = prompt('請輸入部門代碼:');
            const name = prompt('請輸入部門名稱:');
            const manager = prompt('請輸入部門主管:');
            if (code && name && manager) {
                alert(`新增部門成功！\n代碼: ${code}\n名稱: ${name}\n主管: ${manager}`);
            }
        }

        // 匯入匯出功能
        function processImport() {
            const file = document.getElementById('importFile').files[0];
            const type = document.getElementById('importType').value;
            
            if (!file) {
                alert('請選擇要匯入的檔案');
                return;
            }
            
            alert(`開始匯入 ${type} 資料...\n檔案: ${file.name}\n\n匯入完成！`);
        }

        function downloadTemplate() {
            const type = document.getElementById('importType').value;
            let csvContent = '';
            
            switch(type) {
                case 'expenses':
                    csvContent = '申請編號,費用類型,金額,申請日期,說明\nEXP001,511001,1000,2025-08-14,範例費用';
                    break;
                case 'accounts':
                    csvContent = '科目代碼,科目名稱,科目類別\n516001,測試費用,費用類';
                    break;
                case 'departments':
                    csvContent = '部門代碼,部門名稱,部門主管\nTEST,測試部門,測試主管';
                    break;
            }
            
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${type}_template.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link